# 深度策划与技术革新案 (Deep Planning & Tech Revolution)

> [!IMPORTANT]
> 本文档旨在为 FarmOS 的下一阶段（V2.0/V3.0）提供技术选型与设计蓝图。
> 核心目标：提升“黑客”沉浸感，完善游戏循环，增强视觉反馈。

## 1. IDE 终极进化方案 (The IDE Evolution)
**痛点诊断**：
当前基于 `pygame_gui` 原生控件的输入框功能简陋（无高亮、字体渲染一般、Tab支持差），严重影响了“写代码”这一核心玩法的爽快感。

**技术选型分析 (Tech Stack Analysis)**：

### 方案 A：原生增强 (Pygame-GUI + Pygments) 【推荐】
*   **原理**：
    *   引入 Python 著名的语法高亮库 **Pygments**。
    *   在 `update` 循环或用户停止输入 0.5s 后，将纯文本代码传给 Pygments。
    *   Pygments 生成带有 CSS class 或内联样式的 HTML。
    *   利用 `pygame_gui` 支持的 HTML 渲染能力，将彩色代码回填显示。
*   **优点**：
    *   **风格统一**：完美且无缝地融入现在的 UI Theme。
    *   **可控性高**：完全掌握渲染管线。
*   **缺点**：
    *   需要处理光标位置同步（纯文本 vs HTML 文本）的复杂逻辑。

### 方案 B：外部嵌入 (PyImgui / Tkinter Overlay) 【不推荐】
*   **原理**：在 Pygame 窗口之上叠加 ImGui 窗口或嵌入系统原生输入框。
*   **缺点**：画风割裂严重（ImGui 是硬核工控风），破坏沉浸感。

### Action Items (行动指南):
1.  [Tech] 引入 `pygments` 库。
2.  [Code] 编写 `SyntaxHighlighter` 类，负责 Text -> HTML 转换。
3.  [UI] 寻找一款更具极客感的等宽字体（如 JetBrains Mono 或 Fira Code），以此为基础重绘 IDE。

---

## 2. 技能树与展示模式 (Skills & Showcasing)
**痛点诊断**：
目前技能树仅为简单的开关，缺乏“成长度”和“期待感”。玩家还没被展示过“满级之后能多帅”，缺乏动力。

**策划改良 (Design Improvements)**：

1.  **有向无环图 (DAG) 可视化**：
    *   **未解锁 (Locked)**：显示为灰色剪影 + 锁链图标。
    *   **可解锁 (Available)**：呼吸灯特效，高亮显示。
    *   **已解锁 (Mastered)**：金色边框 + 永久连线光效。

2.  **开发者模式 / 演示模式 (Attract Mode)**：
    *   **痛点**：新手不知道代码能写多复杂。
    *   **方案**：在游戏主菜单或引导休息阶段，自动运行一段 **"演示脚本" (Demo Script)**。
        *   内容：数十个无人机协同工作（虚构画面），瞬间种满全屏，又瞬间收割，光效炸裂。
        *   台词："This could be you. (这也可以是你)"
    *   **实装**：在 `examples/` 目录下预置几段 `advanced_spiral_harvest.py` 等“秀操作”代码，玩家并在解锁对应技能后可直接通过 IDE 的 "Load Example" 载入学习。

---

## 3. 生态演化：虫群危机 (Entomology Expansion)
**痛点诊断**：
目前只有“种”和“收”，缺乏“维护”和“应对突发状况”的挑战。

**新机制：动态虫害 (Dynamic Pests)**
*   **机制**：
    *   作物成熟度 > 50% 时，有概率生成 `Pest` (害虫) 实体。
    *   害虫会每秒减少作物产量，甚至吃掉植株。
*   **对抗手段**：
    *   **手动**：点击害虫捏死（初期）。
    *   **自动化**：
        ```python
        # Advanced Drone Code
        entity = farm.scan(x, y)
        if entity.type == "pest":
            drone.zap(x, y) # 发射激光
        ```
*   **技术实现**：
    *   在 `Farm` 网格中增加一层 `Layer` 用于存放 Entity。
    *   新增 API `drone.scan()` 和 `drone.zap()`。

---

## 4. 总结与优先级 (Summary)

1.  **P0 (最高优先)**: **IDE Highlight**。这是核心交互，必须最先打磨。
2.  **P1**: **Demo Script / Examples**。让玩家看到上限，不仅是教学，更是“画饼”。
3.  **P2**: **Pest System**。丰富后期玩法。

此方案已归档，随时可启动开发。
Good night, Pilot.
